<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YOLOv8 Looping Video Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f0f0f0;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .video-container {
        position: relative;
        background: black;
        border-radius: 10px;
        overflow: hidden;
        margin: 20px 0;
      }
      .video-stream {
        width: 100%;
        height: auto;
        display: block;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .status.connected {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #e2e3e5;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .controls {
        text-align: center;
        margin: 20px 0;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 0 10px;
        font-size: 16px;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üî¥ YOLOv8 Looping Video Stream Test</h1>

      <div id="status" class="status">‚è≥ Connecting to video stream...</div>

      <div class="info">
        <h3>üìã Test Information:</h3>
        <ul>
          <li><strong>Stream URL:</strong> http://localhost:5001/video_feed</li>
          <li>
            <strong>Features:</strong> YOLOv8 vehicle detection with continuous
            looping
          </li>
          <li>
            <strong>Expected:</strong> Video should restart automatically when
            it reaches the end
          </li>
          <li>
            <strong>Look for:</strong> "Loop #X" indicator in the top-left
            corner
          </li>
        </ul>
      </div>

      <div class="controls">
        <button onclick="startStream()">‚ñ∂Ô∏è Start Stream</button>
        <button onclick="stopStream()">‚èπÔ∏è Stop Stream</button>
        <button onclick="refreshStream()">üîÑ Refresh Stream</button>
      </div>

      <div class="video-container">
        <img
          id="videoStream"
          class="video-stream"
          alt="YOLOv8 Live Detection Stream"
          style="display: none"
        />
        <div
          id="placeholder"
          style="padding: 50px; text-align: center; color: #666"
        >
          üì∫ Click "Start Stream" to begin viewing the looping YOLOv8 detection
        </div>
      </div>

      <div class="info">
        <h3>üîç What to Look For:</h3>
        <ul>
          <li>
            <strong>üî¥ LIVE indicator:</strong> Pulsing red indicator in
            top-left
          </li>
          <li>
            <strong>Loop counter:</strong> "Loop #1", "Loop #2", etc. showing
            continuous looping
          </li>
          <li>
            <strong>Vehicle detection:</strong> Colored boxes around cars,
            motorcycles, buses, trucks
          </li>
          <li>
            <strong>Real-time stats:</strong> Vehicle count, FPS, frame number
          </li>
          <li>
            <strong>Seamless looping:</strong> Video should restart smoothly
            without interruption
          </li>
        </ul>
      </div>
    </div>

    <script>
      const videoStream = document.getElementById("videoStream");
      const placeholder = document.getElementById("placeholder");
      const status = document.getElementById("status");

      function updateStatus(message, type = "connected") {
        status.textContent = message;
        status.className = `status ${type}`;
      }

      function startStream() {
        const timestamp = new Date().getTime();
        videoStream.src = `http://localhost:5001/video_feed?t=${timestamp}`;
        videoStream.style.display = "block";
        placeholder.style.display = "none";

        videoStream.onload = function () {
          updateStatus(
            "‚úÖ Stream connected - Video looping continuously!",
            "connected"
          );
        };

        videoStream.onerror = function () {
          updateStatus(
            "‚ùå Stream failed - Make sure server is running: python yolo_simple_streamer.py",
            "error"
          );
          placeholder.style.display = "block";
          placeholder.innerHTML = `
                    <h3 style="color: #dc3545;">‚ùå Stream Connection Failed</h3>
                    <p>Make sure the YOLOv8 streaming server is running:</p>
                    <code style="background: #f8f9fa; padding: 10px; border-radius: 5px; display: block; margin: 10px 0;">
                        python yolo_simple_streamer.py
                    </code>
                    <p>Then click "Start Stream" again.</p>
                `;
          videoStream.style.display = "none";
        };

        updateStatus("üîÑ Starting video stream...", "connected");
      }

      function stopStream() {
        videoStream.src = "";
        videoStream.style.display = "none";
        placeholder.style.display = "block";
        placeholder.innerHTML =
          '‚èπÔ∏è Stream stopped - Click "Start Stream" to resume';
        updateStatus("‚èπÔ∏è Stream stopped", "error");
      }

      function refreshStream() {
        if (videoStream.src) {
          const timestamp = new Date().getTime();
          videoStream.src = `http://localhost:5001/video_feed?t=${timestamp}`;
          updateStatus("üîÑ Stream refreshed", "connected");
        }
      }

      // Auto-start stream when page loads
      window.onload = function () {
        setTimeout(startStream, 1000);
      };
    </script>
  </body>
</html>
